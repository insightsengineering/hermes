---
title: "Replace tern::df_explicit_na with a simpler hermes function"
author: "Haocheng Li"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

## Objective: replace `tern::df_explicit_na` with a simpler hermes functio
 
For the example, we use the colData from the `hermes` package. We add one missing value to categorical variable AGE18, and add one missing value to continuous variable BAGE.

```{r}
library(hermes)
dat <- colData(summarized_experiment)
dat[1,4]<-NA
dat[1,59]<-NA
```

### Raw Code
We use `addNA()` function in `base` to add a factor level `NA`. This skips using the `explicit_na` functions in `tern` or `forcats`.

We use `as.data.frame(, stringsAsFactors = TRUE)` to convert character variables into factors without using loop, which is used in `tern::df_explicit_na`.

```{r}

 
a1<-lapply(attr(unclass(dat),"listData"),function(s)  if(is.logical(s)) as.character(s) else s  )
 
a2<-lapply(a1, function(s)  if(is.character(s) & any(is.na(s))) addNA(s) else s  )

dat_convert<-as.data.frame(a2, stringsAsFactors = TRUE)
```

### Test
A new level `NA` is added to `AGE18`.
```{r}
dat_convert$AGE18
```

Continuous variable `BAGE` does not have any change.
```{r}
dat_convert$BAGE
```

Logical variable is converted to factor.
```{r}
dat_convert$LowDepthFlag
```

Original variable with all records missing is converted to a factor with one level `NA`.
```{r}
dat_convert$RACE3
```
