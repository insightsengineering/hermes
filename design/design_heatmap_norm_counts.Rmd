---
title: "Design: Add Heatmap Depicting (normalized) Counts"
author: "Alex Richardson"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

## Objective

A plot method for `AnyHermesData` objects to produce the following plots in default setting: 
1. Generate a heatmap of a single assay, data normalized
2. Title based on input dataset
3. How should the function behave if there are several assays?
4. Organize by assay name or other parameters?
5. Use filter/subset function to remove genes that are zero value for all samples? 
  a. Use subset method of hermes package to filter by low expression using subset/rowData
  b. Ultimate function will have arguments for "filter tech failure, low expr" etc
6. Review differential expression for relevance to heatmap taxonomy
7. Collapse by column groups in dataset, eg country, indication, etc?
8. Colored bands (annotations) above dendrogram, with key or labels - or label dendrogram?
  a. How is the dendrogram determined? Is it useful to supplement with labels, annotations, colors?

## Idea

OK let's first try out how we can obtain an object that can be an input
for the heatmap function:

```{r}

library(hermes)
library(dplyr)
library(ComplexHeatmap)

result <- hermes_data %>%
    normalize(methods = 'voom') %>%
    add_quality_flags()

dim(result)

# Now the filter method option
# No, commenting it out for now
# result <- filter(result[[1]])

result
```

We subset from "not low expression" to remove the genes that don't show up in the samples. This can be done by the user before using the draw_heatmap function.

```{r}
notZeroVector <- rowSums(result)
notZeroVector <- notZeroVector > mean(notZeroVector)
result <- result[notZeroVector,]
```

And here is how we can then obtain the heatmap:

```{r}
Heatmap_plot <- ComplexHeatmap::Heatmap(result)
draw(Heatmap_plot)
```

## Prototype

Here is the prototype function:

```{r}

draw_heatmap <- function(datasetInput,
                         assay_name = "counts")
  {
  filteredData <- datasetInput %>%
    assays()
  
  filteredData <- filteredData[[1]]
 
  Heatmap_plot <- ComplexHeatmap::Heatmap(filteredData, name = assay_name)
  draw(Heatmap_plot)
  }

draw_heatmap(hermes_data)

# And a smaller subset:

draw_heatmap(result[1:40])

```


  
